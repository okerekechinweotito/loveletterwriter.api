import os
from fastapi import APIRouter,status,HTTPException
from fastapi.params import Depends
from sqlalchemy.orm import Session 
from ..database import get_db
from ..crud import UserCrud
from ..import schemas,models
from ..dependencies import get_current_user
from ..utils import hash_password
from sendgrid import SendGridAPIClient
from sendgrid.helpers.mail import Mail
import uuid
from datetime import datetime,timedelta

router=APIRouter(tags=['reset_password'],prefix="/api/v1/reset")

def get_expires_at(minutes:int):
    return (datetime.now() + timedelta(minutes=minutes))


@router.post('/send_reset_email')
def send_reset_email(payload:schemas.PassReset,db:Session = Depends(get_db),):
    email = payload.email
    user = UserCrud.get_user_by_email(db,email)
    if not user:
        raise HTTPException(status_code=status.HTTP_404_NOT_FOUND,detail="There is no user with this email")
    
    new_token = db.query(models.PasswordResetToken).filter(models.PasswordResetToken.email == email).first()
    if new_token:
        if new_token.expiry_time >= datetime.now():
            token_record = new_token
        else:
            db.query(models.PasswordResetToken).filter(models.PasswordResetToken.email == email).delete(synchronize_session=False)
            db.commit()
            token = uuid.uuid4().hex[:6].upper()
            token_record = models.PasswordResetToken(token=token,email=email,expiry_time=get_expires_at(15))
            db.add(token_record)
            db.commit()
            db.refresh(token_record)

    else:
        token = uuid.uuid4().hex[:6].upper()
        token_record = models.PasswordResetToken(token=token,email=email,expiry_time=get_expires_at(15))
        db.add(token_record)
        db.commit()
        db.refresh(token_record)
    
    SMTP_HOST_SENDER = os.getenv("SMTP_HOST_SENDER")

    message = Mail(
    from_email=SMTP_HOST_SENDER,
    to_emails=f"{email}",
    subject=f"Password Reset",
    html_content=f"<p>Here is your reset token: {token_record.token}</p>")
    try:
        SENDGRID_API_KEY = os.getenv('SENDGRID_API_KEY') 
        sg = SendGridAPIClient(SENDGRID_API_KEY)
        response = sg.send(message)
        print(response.status_code)
        print(response.body)
        print(response.headers)
    except Exception as e:
        print(e.message)
    return {'Token Sent successfully to your email'}

@router.post('/validate_token')
def validate_token(payload:schemas.ValidateResetToken,db:Session = Depends(get_db)):
    token = payload.token
    reset_token = db.query(models.PasswordResetToken).filter(models.PasswordResetToken.token == token).first()
    is_valid = None
    if reset_token:
        if reset_token.expiry_time >= datetime.now():
            is_valid = True
        else:
            is_valid = False
    else:
        is_valid = False
    
    if not is_valid:
        raise HTTPException(status_code=status.HTTP_400_BAD_REQUEST,detail="Invalid token")
    
    return {"Token Validated, Go on to password reset"}

@router.post('/password_reset')
def password_reset(payload:schemas.NewPassword,db:Session = Depends(get_db)):
    new_password = payload.password
    token = payload.token
    reset_token = db.query(models.PasswordResetToken).filter(models.PasswordResetToken.token == token).first()
    email = reset_token.email
    user = UserCrud.get_user_by_email(db,email)
    new_password = hash_password(new_password)
    user.password = new_password
    db.query(models.PasswordResetToken).filter(models.PasswordResetToken.token == token).delete(synchronize_session=False)
    db.commit()
    
    return {'Password Reset successful'}

@router.post('/dds')
def test_template():
    SMTP_HOST_SENDER = os.getenv("SMTP_HOST_SENDER")

    message = Mail(
    from_email=SMTP_HOST_SENDER,
    to_emails="livingstonemaxwell971@gmail.com",
    subject=f"Password Reset",
    html_content="<!DOCTYPE html>
<html lang="en">
​
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      height: 100vh;
    }
    @media screen and (min-width: 768px) {
      header {
        padding: 10px 50px;
      }
      main {
        padding: 10px 50px;
      }
  }
  </style>
  <title>Loveme</title>
</head>
​
<body style="font-family: 'Avenir', sans-serif; color: #374957; padding: 10px 20px; display: flex; flex-direction: column; justify-content: space-around;">
  <header>
    <svg width="152" height="42" viewBox="0 0 152 42" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g clip-path="url(#clip0_5821_9536)">
        <path
          d="M20.9998 41.9998C30.2024 41.9998 35.3163 41.9998 38.6579 38.6579C42 35.3164 42 30.2026 42 21C42 11.7977 42 6.68374 38.658 3.34195C35.3164 0 30.2026 0 21 0C11.7977 0 6.67734 0 3.34195 3.34179C0.00656265 6.68358 0 11.7976 0 20.9998C0 30.2024 0 35.3163 3.34179 38.6579C6.68358 42 11.7976 42 20.9998 42V41.9998Z"
          fill="#EF3939" />
        <path
          d="M34.6535 13.2287C33.6397 11.4009 31.8959 9.90416 30.2541 8.61004C28.6124 7.31591 27.0008 6.53629 24.9864 5.97716C22.9719 5.41804 20.9132 5.42837 18.8393 5.6912C16.7652 5.95403 14.9806 6.42752 13.1693 7.47145C11.3582 8.51538 9.95155 9.79359 8.68466 11.4564C7.4181 13.1191 6.5763 14.7703 6.0508 16.7933C5.52548 18.8162 5.335 21.0576 5.63261 23.1263C5.93022 25.1951 6.29165 27.1639 7.36609 28.9571L7.45469 29.1087L14.8523 41.9328C16.0801 41.9666 17.409 41.9813 18.8393 41.9771H20.9401C24.2949 42.0493 27.6513 41.95 30.9959 41.6798C34.3434 41.3128 36.748 40.4903 38.5896 38.6368C41.2982 35.9287 41.8109 32.0569 41.9057 25.7935L34.6535 13.2287Z"
          fill="url(#paint0_linear_5821_9536)" />
        <path
          d="M32.1248 9.85789C29.9224 7.65669 27.1168 6.15806 24.0627 5.55154C21.0085 4.94502 17.8431 5.25785 14.9668 6.45048C12.0903 7.64311 9.63196 9.66182 7.9026 12.2514C6.173 14.8413 5.24988 17.8857 5.24988 21C5.24988 24.1144 6.173 27.1588 7.9026 29.7487C9.63194 32.3383 12.0903 34.3571 14.9668 35.5498C17.8431 36.7423 21.0085 37.0551 24.0627 36.4486C27.1168 35.842 29.9225 34.3434 32.1248 32.1422C34.3327 29.9407 35.8368 27.1329 36.4462 24.0751C37.0556 21.0174 36.7428 17.8475 35.5476 14.9678C34.754 13.0559 33.5908 11.3194 32.1248 9.85789ZM31.1806 17.1086C28.5841 21.6272 25.9883 26.1462 23.3932 30.6656C23.1887 31.0661 22.8839 31.4067 22.5086 31.6544C22.1332 31.902 21.7002 32.0483 21.2515 32.0788C20.7563 32.1342 20.256 32.0385 19.8161 31.8044C19.3762 31.5703 19.0174 31.2087 18.7867 30.767C17.1456 27.9402 15.5169 25.0945 13.8886 22.2549C12.8909 20.5297 11.8982 18.8016 10.9105 17.0706C10.676 16.6816 10.5466 16.2383 10.5352 15.7842C10.5238 15.3301 10.6308 14.8809 10.8456 14.4807C11.0603 14.0804 11.3755 13.7429 11.7602 13.5014C12.1449 13.2598 12.5858 13.1225 13.0396 13.1029C13.5281 13.0729 14.0148 13.1851 14.441 13.4258C14.8671 13.6665 15.2144 14.0255 15.4409 14.4594C16.1759 15.7269 16.8983 16.9944 17.6208 18.2622C18.1467 19.1748 18.6535 20.0874 19.1921 20.9874C19.5345 21.6093 20.0319 22.1322 20.6358 22.5055C21.2397 22.8785 21.9298 23.0891 22.639 23.1169C23.7164 23.1838 24.7782 22.8333 25.604 22.1382C26.4299 21.4432 26.9565 20.4568 27.0746 19.3839C27.0746 19.2127 27.0746 19.0416 27.1127 18.9529C27.1164 18.2748 26.9647 17.6048 26.6692 16.9944C26.4423 16.5733 26.335 16.0981 26.3592 15.6203C26.3834 15.1426 26.538 14.6806 26.8062 14.2845C27.0745 13.8884 27.4462 13.5734 27.8808 13.3737C28.3155 13.174 28.7966 13.0973 29.2719 13.1518C29.6512 13.1955 30.0164 13.3216 30.3418 13.5214C30.6671 13.7213 30.9448 13.9899 31.1553 14.3084C31.366 14.627 31.5043 14.9879 31.5607 15.3656C31.6321 15.9727 31.4984 16.5863 31.1806 17.1086Z"
          fill="white" />
      </g>
      <path
        d="M58.049 9.884H55.457V29H66.824V26.57H58.049V9.884ZM75.02 15.878C71.213 15.878 68.216 18.875 68.216 22.601C68.216 26.408 71.321 29.324 75.02 29.324C78.827 29.324 81.824 26.327 81.824 22.601C81.824 18.686 78.638 15.878 75.02 15.878ZM70.808 22.601C70.808 19.982 72.509 18.146 74.993 18.146C77.504 18.146 79.232 19.901 79.232 22.601C79.232 25.247 77.558 27.056 75.02 27.056C72.509 27.056 70.808 25.274 70.808 22.601ZM83.3292 16.202L88.5402 29H91.2132L96.2352 16.202H93.6432L89.9712 26.003L86.1372 16.202H83.3292ZM104.227 15.878C100.339 15.878 97.6122 18.821 97.6122 22.601C97.6122 26.678 100.393 29.324 104.2 29.324C106.657 29.324 108.493 28.46 109.87 26.705L108.034 25.301C107.089 26.462 106.009 27.218 104.524 27.218C102.283 27.218 100.204 25.706 100.204 23.492H110.464V22.817C110.464 18.389 108.007 15.878 104.227 15.878ZM107.872 21.548H100.204C100.204 20.009 101.608 17.822 104.173 17.822C106.441 17.822 107.791 19.145 107.872 21.548ZM113.803 29H116.395V13.286H116.449L122.902 29H124.63L131.083 13.286H131.137V29H133.729V9.884H129.868L123.847 24.356H123.739L117.664 9.884H113.803V29ZM143.699 15.878C139.811 15.878 137.084 18.821 137.084 22.601C137.084 26.678 139.865 29.324 143.672 29.324C146.129 29.324 147.965 28.46 149.342 26.705L147.506 25.301C146.561 26.462 145.481 27.218 143.996 27.218C141.755 27.218 139.676 25.706 139.676 23.492H149.936V22.817C149.936 18.389 147.479 15.878 143.699 15.878ZM147.344 21.548H139.676C139.676 20.009 141.08 17.822 143.645 17.822C145.913 17.822 147.263 19.145 147.344 21.548Z"
        fill="#464646" />
      <defs>
        <linearGradient id="paint0_linear_5821_9536" x1="13.1333" y1="7.38939" x2="33.1671" y2="42.1006"
          gradientUnits="userSpaceOnUse">
          <stop stop-opacity="0.2" />
          <stop offset="0.79" stop-opacity="0.05" />
        </linearGradient>
        <clipPath id="clip0_5821_9536">
          <rect width="42" height="42" fill="white" />
        </clipPath>
      </defs>
    </svg>
  </header>
  <main>
    <section class="title" style="margin: 20px;
    text-align: center; border-top: 2px solid #cecece; border-bottom: 2px solid #cecece;">
      <h1 style="
          font-weight: 200;
          font-size: 24px;
          line-height: 27px;
          font-style: italic;
      ">Title Template</h1>
    </section>
    <section class="body" style="
      margin: 2em 1em;
    ">
      <p style="font-size: 18px;
      line-height: 16px;
      color: #374957;">
        <span>Hi John,</span> <br /> <br />
        Lorem ipsum dolor, sit amet consectetur adipisicing elit. Similique doloremque veritatis enim at deserunt?
        Cumque, iste. Voluptate ipsa cum iusto nihil maxime facilis neque ea dolore sunt. Molestiae, soluta consequuntur
      </p>
    </section>
    <section class="btn-container" style="display: flex;
      align-items: center;
      justify-content: center;
    ">
      <button type="button" style="
        background: #d2120f;
        border: 1px solid #d2120f;
        border-radius: 8px;
        padding: 16px 28px;
        color: #fff;
        font-size: 18px;
        line-height: 28px;
      ">Action button</button>
    </section>
  </main>
  <footer style="width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
    <ul class="socials"
      style="display: flex; list-style: none; gap: 1em; align-items: center; justify-content: center;">
      <li style="border-radius: 75%;"><svg width="15" height="16"
          viewBox="0 0 11 10" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M10.4962 1.90352C10.5655 1.77519 10.6226 1.64064 10.6668 1.50164C10.6873 1.43716 10.6877 1.368 10.668 1.30328C10.6483 1.23857 10.6095 1.18134 10.5566 1.13916C10.5037 1.09698 10.4393 1.07183 10.3718 1.06703C10.3043 1.06222 10.237 1.078 10.1787 1.11227C9.85843 1.30252 9.51175 1.44427 9.14993 1.53289C8.71073 1.1365 8.14032 0.91675 7.54868 0.916016C7.22726 0.916263 6.90919 0.981411 6.61355 1.10755C6.31791 1.2337 6.05079 1.41824 5.82819 1.65011C5.60559 1.88199 5.43211 2.15642 5.31814 2.45697C5.20417 2.75751 5.15206 3.07797 5.16494 3.39914C3.75932 3.22219 2.47577 2.51092 1.58056 1.41289C1.54626 1.37129 1.50243 1.33859 1.45278 1.31755C1.40314 1.29652 1.34915 1.28778 1.29541 1.29207C1.24166 1.29637 1.18975 1.31357 1.14408 1.34222C1.0984 1.37087 1.06032 1.41012 1.03306 1.45664C0.828075 1.80847 0.716657 2.20695 0.709436 2.61408C0.702215 3.0212 0.799431 3.42339 0.99181 3.78227C0.944628 3.79023 0.899299 3.80675 0.85806 3.83102C0.807526 3.86324 0.765921 3.90767 0.737084 3.96021C0.708247 4.01275 0.693107 4.07171 0.69306 4.13164C0.69306 4.84102 1.00869 5.49227 1.51744 5.93477L1.49556 5.95664C1.45715 6.00009 1.43073 6.0528 1.41889 6.10957C1.40705 6.16634 1.41021 6.22521 1.42806 6.28039C1.53415 6.61134 1.71128 6.91511 1.94706 7.17044C2.18285 7.42576 2.47158 7.62647 2.79306 7.75851C2.1328 8.08061 1.39391 8.20621 0.66431 8.12039C0.589313 8.11275 0.513899 8.1302 0.449883 8.17001C0.385868 8.20982 0.336867 8.26974 0.31056 8.34039C0.285296 8.41156 0.284822 8.48918 0.309214 8.56065C0.333606 8.63213 0.381433 8.69326 0.444935 8.73414C1.43682 9.37074 2.59072 9.70894 3.76931 9.70852C7.63181 9.70852 9.94056 6.57102 9.94056 3.53789L9.93993 3.43539C10.3143 3.14315 10.6394 2.79289 10.9031 2.39789C10.943 2.33818 10.9626 2.26719 10.9591 2.19545C10.9555 2.12371 10.9289 2.05502 10.8833 1.99956C10.8376 1.9441 10.7753 1.90481 10.7056 1.88751C10.6359 1.87021 10.5625 1.87582 10.4962 1.90352ZM9.40556 3.00039C9.36021 3.033 9.32374 3.07646 9.29951 3.12679C9.27527 3.17712 9.26403 3.23272 9.26681 3.28852C9.27056 3.37102 9.27244 3.45477 9.27244 3.53727C9.27244 6.24227 7.21431 9.04039 3.76993 9.04039C3.15562 9.04067 2.54565 8.93756 1.96556 8.73539C2.66031 8.60225 3.31296 8.30432 3.86868 7.86664C3.92278 7.82399 3.96238 7.76567 3.98208 7.69965C4.00177 7.63364 4.00059 7.56315 3.9787 7.49783C3.95682 7.43251 3.91529 7.37554 3.8598 7.33472C3.8043 7.2939 3.73756 7.27121 3.66868 7.26977C3.3992 7.26462 3.1347 7.19621 2.89651 7.07006C2.65832 6.94391 2.45311 6.76354 2.29743 6.54351C2.45556 6.53289 2.61056 6.50664 2.76119 6.46602C2.83408 6.44651 2.89822 6.40286 2.94313 6.34221C2.98803 6.28156 3.01106 6.20749 3.00845 6.13207C3.00584 6.05665 2.97774 5.98434 2.92875 5.92694C2.87976 5.86954 2.81276 5.83044 2.73868 5.81602C2.43432 5.7541 2.15252 5.61061 1.92343 5.40089C1.69433 5.19117 1.52656 4.92311 1.43806 4.62539C1.60431 4.66727 1.77493 4.69164 1.94556 4.69727C2.09243 4.69664 2.22868 4.60664 2.27431 4.46539C2.31993 4.32414 2.26618 4.16852 2.14181 4.08602C1.84773 3.89008 1.6213 3.60815 1.49344 3.27871C1.36558 2.94928 1.34253 2.58841 1.42744 2.24539C2.51308 3.35934 3.97903 4.02267 5.53243 4.10289C5.64243 4.10352 5.73868 4.06414 5.80556 3.98352C5.87243 3.90289 5.89806 3.79602 5.87431 3.69352C5.78883 3.32539 5.82706 2.93935 5.98309 2.59515C6.13912 2.25094 6.40425 1.96776 6.73744 1.78942C7.07064 1.61108 7.45332 1.54753 7.82627 1.6086C8.19923 1.66967 8.54165 1.85197 8.80056 2.12727C8.83936 2.16867 8.88807 2.19951 8.94208 2.2169C8.99609 2.23428 9.05364 2.23763 9.10931 2.22664C9.21244 2.20602 9.31431 2.18227 9.41493 2.15477C9.36957 2.18872 9.32242 2.22023 9.27368 2.24914C9.20887 2.28884 9.15952 2.34944 9.13376 2.42094C9.108 2.49245 9.10737 2.57059 9.13197 2.64251C9.15657 2.71442 9.20494 2.7758 9.2691 2.81655C9.33326 2.85729 9.40939 2.87496 9.48494 2.86664L9.59868 2.85227C9.53605 2.90386 9.47163 2.95327 9.40556 3.00039Z"
            fill="#161616" />
        </svg></li>
      <li style="border-radius: 50%;">
        <svg width="16" height="16" viewBox="0 0 7 12" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M6.18751 0.374537H4.52001C2.39626 0.353287 2.12501 1.66766 2.12501 3.09016V4.12454H1.18751C1.14513 4.11888 1.10203 4.12306 1.06153 4.13676C1.02104 4.15047 0.984248 4.17332 0.95402 4.20355C0.923791 4.23378 0.900938 4.27057 0.887234 4.31106C0.873531 4.35156 0.869347 4.39466 0.875007 4.43704V6.31204C0.869347 6.35441 0.873531 6.39752 0.887234 6.43801C0.900938 6.47851 0.923791 6.5153 0.95402 6.54552C0.984248 6.57575 1.02104 6.59861 1.06153 6.61231C1.10203 6.62601 1.14513 6.6302 1.18751 6.62454H2.12501V11.312C2.1198 11.3545 2.12436 11.3976 2.13835 11.438C2.15234 11.4784 2.17537 11.5151 2.20571 11.5452C2.23604 11.5754 2.27286 11.5982 2.31336 11.6119C2.35386 11.6257 2.39696 11.63 2.43938 11.6245H4.34876C4.53313 11.6458 4.68251 11.4964 4.62376 11.312L4.62501 6.62454H6.18751C6.22988 6.6302 6.27299 6.62601 6.31348 6.61231C6.35398 6.59861 6.39077 6.57575 6.421 6.54552C6.45122 6.5153 6.47408 6.47851 6.48778 6.43801C6.50148 6.39752 6.50567 6.35441 6.50001 6.31204V4.43704C6.50567 4.39466 6.50148 4.35156 6.48778 4.31106C6.47408 4.27057 6.45122 4.23378 6.421 4.20355C6.39077 4.17332 6.35398 4.15047 6.31348 4.13676C6.27299 4.12306 6.22988 4.11888 6.18751 4.12454H4.62313L4.62501 3.18704C4.68563 2.78766 4.68563 2.85266 5.05626 2.87454H6.17438C6.26126 2.85516 6.35376 2.86579 6.41876 2.80266C6.48376 2.73954 6.52126 2.65329 6.49938 2.56204V0.687037C6.50515 0.644698 6.50106 0.601598 6.48744 0.561098C6.47382 0.520597 6.45103 0.48379 6.42084 0.453545C6.39066 0.4233 6.3539 0.400434 6.31342 0.386729C6.27295 0.373025 6.22986 0.368852 6.18751 0.374537ZM5.85313 2.21454L5.06938 2.18454C4.09876 2.18454 4.01751 2.71141 4.01751 3.25079L4.01501 4.43579C4.01493 4.47967 4.0235 4.52313 4.04023 4.5637C4.05697 4.60426 4.08154 4.64113 4.11254 4.67219C4.14354 4.70325 4.18036 4.72789 4.22089 4.7447C4.26143 4.76151 4.30488 4.77016 4.34876 4.77016H5.87501V5.97766H4.35001C4.26143 5.97766 4.17648 6.0128 4.11379 6.07538C4.0511 6.13795 4.0158 6.22284 4.01563 6.31141L4.01501 10.9995H2.75001V6.31204C2.75001 6.12766 2.62438 5.97829 2.43938 5.97829H1.50001V4.77079H2.43938C2.48324 4.77085 2.52667 4.76228 2.56721 4.74555C2.60775 4.72882 2.64459 4.70426 2.67563 4.67329C2.73813 4.61016 2.74938 4.52516 2.74938 4.43641V3.08954C2.74938 1.68829 3.03251 1.02079 4.51938 1.02079H5.85251V2.21454H5.85313Z"
            fill="#161616" />
        </svg>
      </li>
      <li style="border-radius: 50%;">
        <svg width="18" height="18" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M7.19688 3.46977C6.77313 3.46977 6.45938 3.57664 6.21376 3.71164C6.17438 3.57164 6.04501 3.46914 5.89251 3.49977H4.02751C3.84314 3.46914 3.69376 3.61852 3.75064 3.81227V10.6873C3.69376 10.8623 3.84314 11.0123 4.02751 10.9998H5.89251C6.07688 11.0123 6.22626 10.8623 6.22626 10.6779L6.22564 6.52289C6.22501 6.52102 6.21813 6.32227 6.34376 6.18539C6.44438 6.07664 6.61751 6.02102 6.85689 6.02102C7.25564 6.02102 7.43314 6.18414 7.49939 6.54914V10.6779C7.43376 10.8623 7.58313 11.0123 7.76751 10.9998H9.73314C9.91751 11.0123 10.0669 10.8623 10.0006 10.6779V6.41039C10.0663 4.24039 8.52063 3.46977 7.19688 3.46977ZM9.39876 10.3748H8.10126V6.54914C8.10126 5.81102 7.62438 5.35352 6.85751 5.35352C6.42376 5.35352 6.08626 5.48102 5.85376 5.73226C5.53063 6.08226 5.55563 6.52602 5.62501 6.62477V10.3748H4.36126V4.13727H5.55876V4.34727C5.55827 4.40982 5.57544 4.47125 5.6083 4.52449C5.64115 4.57773 5.68836 4.62061 5.7445 4.64823C5.80063 4.67584 5.86342 4.68705 5.92565 4.68058C5.98787 4.67411 6.04701 4.65021 6.09626 4.61164L6.18376 4.54414C6.43688 4.34477 6.69876 4.13789 7.19751 4.13789C7.71376 4.13789 9.39938 4.30227 9.39938 6.41102V10.3748H9.39876ZM1.87501 0.353516C1.17376 0.353516 0.60376 0.923516 0.60376 1.62477C0.60376 2.32602 1.17376 2.89602 1.87501 2.89602C2.57626 2.89602 3.14626 2.32602 3.14626 1.62477C3.14626 0.923516 2.57626 0.353516 1.87501 0.353516ZM1.87501 2.22852C1.54251 2.22852 1.27126 1.95727 1.27126 1.62477C1.27126 1.29227 1.54251 1.02102 1.87501 1.02102C2.20751 1.02102 2.47876 1.29227 2.47876 1.62477C2.47876 1.95727 2.20751 2.22852 1.87501 2.22852ZM2.76751 3.46914H0.91251C0.728135 3.46914 0.57876 3.61852 0.62501 3.81227V10.6873C0.57876 10.8623 0.728135 11.0123 0.91251 10.9998H2.76751C2.95189 11.0123 3.10126 10.8623 3.10126 10.6779V3.80289C3.10126 3.71437 3.0661 3.62948 3.00351 3.56689C2.94092 3.5043 2.85603 3.46914 2.76751 3.46914ZM2.50001 10.3748H1.24626V4.13727H2.50001V10.3748Z"
            fill="#161616" />
        </svg>
      </li>
      <li>
        <svg width="32" height="32" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M14.2954 3.85449H7.70455C5.57789 3.85449 3.85425 5.57844 3.85425 7.7048V14.2956C3.85425 16.4223 5.57819 18.1459 7.70486 18.1459H14.2951C16.4217 18.1459 18.1457 16.422 18.1457 14.2953V7.7048C18.1457 5.57813 16.4217 3.85449 14.2951 3.85449H14.2954Z"
            fill="white" />
          <path
            d="M14.2954 3.85449H7.70455C5.57789 3.85449 3.85425 5.57844 3.85425 7.7048V14.2956C3.85425 16.4223 5.57819 18.1459 7.70486 18.1459H14.2951C16.4217 18.1459 18.1457 16.422 18.1457 14.2953V7.7048C18.1457 5.57813 16.4217 3.85449 14.2951 3.85449H14.2954Z"
            stroke="#161616" stroke-miterlimit="10" />
          <path
            d="M11 14.4497C12.9052 14.4497 14.4497 12.9052 14.4497 11C14.4497 9.09479 12.9052 7.55029 11 7.55029C9.09479 7.55029 7.55029 9.09479 7.55029 11C7.55029 12.9052 9.09479 14.4497 11 14.4497Z"
            stroke="#161616" stroke-miterlimit="10" />
          <path
            d="M15.1888 7.55006C15.5971 7.55006 15.928 7.21913 15.928 6.81092C15.928 6.4027 15.5971 6.07178 15.1888 6.07178C14.7806 6.07178 14.4497 6.4027 14.4497 6.81092C14.4497 7.21913 14.7806 7.55006 15.1888 7.55006Z"
            fill="#161616" />
        </svg>
​
      </li>
    </ul>
    <div>
      <svg width="85" height="25" viewBox="0 0 85 25" fill="none" xmlns="http://www.w3.org/2000/svg">
        <g clip-path="url(#clip0_5821_9543)">
          <path
            d="M12.1363 24.9997C17.4547 24.9997 20.41 24.9997 22.3412 23.0683C24.2727 21.1372 24.2727 18.1818 24.2727 12.8634C24.2727 7.54522 24.2727 4.58973 22.3413 2.65844C20.4101 0.727051 17.4547 0.727051 12.1364 0.727051C6.81817 0.727051 3.85898 0.727051 1.93139 2.65834C0.0037927 4.58964 0 7.54513 0 12.8633C0 18.1817 0 21.1371 1.93129 23.0683C3.86259 24.9998 6.81808 24.9998 12.1363 24.9998V24.9997Z"
            fill="#EF3939" />
          <path
            d="M20.027 8.37176C19.4411 7.31543 18.4333 6.45043 17.4845 5.70252C16.5357 4.95462 15.6043 4.50406 14.4402 4.18093C13.2759 3.8578 12.0862 3.86377 10.8876 4.01566C9.68898 4.16756 8.65758 4.44119 7.61082 5.0445C6.56415 5.64781 5.75121 6.38652 5.01904 7.34747C4.28707 8.30843 3.80057 9.26265 3.49688 10.4318C3.19328 11.6009 3.0832 12.8963 3.25519 14.0918C3.42719 15.2874 3.63607 16.4252 4.25701 17.4615L4.30821 17.5491L8.58344 24.9605C9.29303 24.98 10.061 24.9885 10.8876 24.9861H12.1017C14.0405 25.0278 15.9803 24.9704 17.9132 24.8143C19.8478 24.6022 21.2375 24.1269 22.3018 23.0556C23.8671 21.4906 24.1634 19.253 24.2182 15.6332L20.027 8.37176Z"
            fill="url(#paint0_linear_5821_9543)" />
          <path
            d="M18.5658 6.42423C17.293 5.15211 15.6715 4.28602 13.9065 3.9355C12.1414 3.58497 10.3121 3.76577 8.64981 4.45501C6.98741 5.14426 5.56668 6.31092 4.56725 7.8075C3.56767 9.30424 3.03418 11.0637 3.03418 12.8635C3.03418 14.6634 3.56767 16.4228 4.56725 17.9196C5.56667 19.4162 6.98739 20.5829 8.64981 21.2721C10.3121 21.9613 12.1415 22.1421 13.9065 21.7916C15.6716 21.441 17.293 20.5749 18.5658 19.3028C19.8418 18.0305 20.711 16.4078 21.0632 14.6407C21.4154 12.8735 21.2347 11.0416 20.5439 9.37735C20.0853 8.27241 19.413 7.26886 18.5658 6.42423ZM18.0201 10.6146C16.5195 13.226 15.0194 15.8376 13.5196 18.4495C13.4014 18.6809 13.2253 18.8778 13.0084 19.0209C12.7914 19.164 12.5412 19.2485 12.2819 19.2662C11.9957 19.2982 11.7065 19.2429 11.4523 19.1076C11.1981 18.9723 10.9907 18.7633 10.8574 18.5081C9.90895 16.8744 8.96772 15.2298 8.02668 13.5888C7.4501 12.5917 6.8764 11.593 6.30559 10.5926C6.17003 10.3678 6.09529 10.1116 6.0887 9.84918C6.08212 9.58676 6.14392 9.32714 6.26804 9.09583C6.39216 8.86452 6.57433 8.66948 6.79663 8.52988C7.01894 8.39028 7.27375 8.31091 7.53601 8.29959C7.81833 8.28227 8.09963 8.34708 8.34591 8.4862C8.59219 8.62532 8.79291 8.83278 8.92382 9.08352C9.34859 9.81606 9.76607 10.5486 10.1836 11.2812C10.4875 11.8087 10.7804 12.3361 11.0917 12.8562C11.2896 13.2156 11.577 13.5178 11.9261 13.7335C12.2751 13.9491 12.6739 14.0708 13.0838 14.0869C13.7064 14.1256 14.32 13.923 14.7973 13.5213C15.2746 13.1196 15.5789 12.5496 15.6472 11.9295C15.6472 11.8306 15.6472 11.7317 15.6692 11.6804C15.6713 11.2885 15.5837 10.9013 15.4129 10.5486C15.2817 10.3052 15.2198 10.0306 15.2337 9.75448C15.2477 9.47837 15.337 9.21136 15.4921 8.98246C15.6471 8.75356 15.8619 8.57152 16.1131 8.45612C16.3643 8.34071 16.6424 8.29634 16.917 8.32784C17.1363 8.35308 17.3473 8.426 17.5353 8.54148C17.7234 8.65696 17.8839 8.81219 18.0055 8.99629C18.1272 9.18043 18.2072 9.38897 18.2398 9.60728C18.2811 9.9581 18.2038 10.3127 18.0201 10.6146Z"
            fill="white" />
        </g>
        <path
          d="M31.9094 17.6162C31.795 17.6162 31.7118 17.585 31.6597 17.5226C31.6077 17.4498 31.5869 17.3561 31.5973 17.2417L33.2513 6.83392C33.2721 6.71949 33.3086 6.64147 33.3606 6.59986C33.423 6.54785 33.5062 6.52184 33.6102 6.52184C33.7247 6.52184 33.8027 6.55825 33.8443 6.63107C33.8963 6.69348 33.9119 6.7819 33.8911 6.89633L32.2995 17.0077H37.8701C37.9741 17.0077 38.0521 17.0285 38.1042 17.0701C38.1666 17.1013 38.1978 17.1585 38.1978 17.2417C38.1978 17.377 38.1614 17.4758 38.0885 17.5382C38.0157 17.5902 37.9325 17.6162 37.8389 17.6162H31.9094ZM42.6053 17.741C41.9915 17.741 41.4558 17.611 40.9981 17.3509C40.5403 17.0909 40.1867 16.7216 39.937 16.2431C39.6977 15.7541 39.5781 15.1716 39.5781 14.4954C39.5781 13.8921 39.6561 13.3199 39.8122 12.779C39.9786 12.2277 40.2231 11.7387 40.5455 11.3122C40.868 10.8857 41.2633 10.5528 41.7314 10.3136C42.1996 10.0639 42.7405 9.93909 43.3543 9.93909C43.9784 9.93909 44.5141 10.0691 44.9615 10.3292C45.4192 10.5893 45.7677 10.9637 46.0069 11.4527C46.2566 11.9312 46.3814 12.5085 46.3814 13.1847C46.3814 13.7881 46.2982 14.3654 46.1317 14.9167C45.9757 15.4577 45.7364 15.9414 45.414 16.3679C45.0915 16.7944 44.6962 17.1325 44.2281 17.3822C43.76 17.6214 43.219 17.741 42.6053 17.741ZM42.6365 17.1325C43.3022 17.1325 43.864 16.9504 44.3217 16.5864C44.7794 16.2223 45.1227 15.7385 45.3516 15.1352C45.5908 14.5318 45.7104 13.8713 45.7104 13.1535C45.7104 12.2901 45.4972 11.6399 45.0707 11.203C44.6546 10.7661 44.072 10.5476 43.323 10.5476C42.6573 10.5476 42.0955 10.7297 41.6378 11.0938C41.1801 11.4579 40.8316 11.9416 40.5924 12.5449C40.3635 13.1379 40.2491 13.7985 40.2491 14.5266C40.2491 15.3797 40.4571 16.0298 40.8732 16.4771C41.2997 16.914 41.8875 17.1325 42.6365 17.1325ZM50.426 17.7098C50.3012 17.7098 50.2023 17.6786 50.1295 17.6162C50.0671 17.5434 50.0151 17.4394 49.9735 17.3041L48.1478 10.4852C48.127 10.3812 48.1218 10.2928 48.1322 10.22C48.153 10.1471 48.1894 10.0899 48.2414 10.0483C48.3039 9.99631 48.3819 9.9703 48.4755 9.9703C48.5691 9.9703 48.6367 9.99631 48.6783 10.0483C48.7304 10.0899 48.772 10.168 48.8032 10.2824L50.6132 17.3822H50.2387L54.3582 10.22C54.4102 10.1367 54.4622 10.0743 54.5142 10.0327C54.5662 9.99111 54.6338 9.9703 54.7171 9.9703C54.8107 9.9703 54.8835 9.99631 54.9355 10.0483C54.9979 10.1003 55.0291 10.168 55.0291 10.2512C55.0395 10.324 55.0135 10.4124 54.9511 10.5164L50.9409 17.3822C50.8785 17.4862 50.8109 17.5642 50.7381 17.6162C50.6652 17.6786 50.5612 17.7098 50.426 17.7098ZM58.9617 17.741C58.2855 17.741 57.6978 17.611 57.1984 17.3509C56.7095 17.0909 56.335 16.7216 56.075 16.2431C55.8149 15.7541 55.6849 15.1716 55.6849 14.4954C55.6849 13.6944 55.8357 12.9506 56.1374 12.2641C56.4391 11.5671 56.8812 11.0054 57.4637 10.5789C58.0463 10.1523 58.7536 9.93909 59.5858 9.93909C60.1476 9.93909 60.6157 10.0431 60.9902 10.2512C61.3751 10.4488 61.6768 10.7193 61.8952 11.0626C62.1241 11.4059 62.2697 11.796 62.3321 12.2329C62.4049 12.6698 62.4101 13.1171 62.3477 13.5748C62.3269 13.7204 62.2905 13.8245 62.2385 13.8869C62.1865 13.9389 62.0929 13.9649 61.9576 13.9649H56.1374L56.231 13.3876H62.0357L61.7392 13.5748C61.8224 13.0131 61.8016 12.5033 61.6768 12.0456C61.5623 11.5879 61.3335 11.2238 60.9902 10.9533C60.6573 10.6725 60.184 10.532 59.5702 10.532C58.9149 10.532 58.3687 10.6829 57.9318 10.9846C57.5053 11.2758 57.1724 11.6503 56.9332 12.108C56.6939 12.5553 56.5327 13.0183 56.4495 13.4968L56.4026 13.7777C56.2362 14.7763 56.3766 15.5877 56.824 16.2119C57.2817 16.8256 57.9838 17.1325 58.9305 17.1325C59.3674 17.1325 59.7679 17.0805 60.132 16.9765C60.4961 16.862 60.855 16.6748 61.2086 16.4147C61.3023 16.3419 61.3855 16.3055 61.4583 16.3055C61.5311 16.2951 61.5935 16.3107 61.6456 16.3523C61.6976 16.3835 61.7288 16.4303 61.7392 16.4927C61.76 16.5551 61.7548 16.628 61.7236 16.7112C61.6924 16.784 61.6352 16.8516 61.5519 16.914C61.2086 17.1741 60.8029 17.377 60.3348 17.5226C59.8771 17.6682 59.4194 17.741 58.9617 17.741ZM64.3363 17.6162C64.2426 17.6162 64.1698 17.585 64.1178 17.5226C64.0658 17.4602 64.045 17.3717 64.0554 17.2573L65.7094 6.83392C65.7302 6.71949 65.7666 6.64147 65.8186 6.59986C65.8706 6.54785 65.9435 6.52184 66.0371 6.52184C66.1307 6.52184 66.1983 6.54785 66.2399 6.59986C66.2919 6.64147 66.3336 6.70909 66.3648 6.80271L69.548 15.6345H69.1266L75.1966 6.74029C75.2486 6.66748 75.3006 6.61546 75.3526 6.58426C75.4046 6.54264 75.4722 6.52184 75.5555 6.52184C75.6491 6.52184 75.7167 6.55825 75.7583 6.63107C75.8103 6.69348 75.8259 6.7819 75.8051 6.89633L74.1511 17.3197C74.1407 17.4134 74.1095 17.4862 74.0575 17.5382C74.0159 17.5902 73.9431 17.6162 73.839 17.6162C73.7454 17.6162 73.6726 17.585 73.6206 17.5226C73.5686 17.4602 73.5478 17.3717 73.5582 17.2573L75.1341 7.23962H75.5242L69.6884 15.7906C69.6468 15.8634 69.6 15.9154 69.548 15.9466C69.4959 15.9778 69.4283 15.9934 69.3451 15.9934C69.2515 15.9934 69.1787 15.9726 69.1266 15.931C69.0746 15.879 69.033 15.8062 69.0018 15.7125L65.9278 7.22402H66.2399L64.6483 17.3197C64.6379 17.4134 64.6067 17.4862 64.5547 17.5382C64.5131 17.5902 64.4403 17.6162 64.3363 17.6162ZM80.2951 17.741C79.619 17.741 79.0312 17.611 78.5319 17.3509C78.043 17.0909 77.6685 16.7216 77.4084 16.2431C77.1484 15.7541 77.0183 15.1716 77.0183 14.4954C77.0183 13.6944 77.1692 12.9506 77.4708 12.2641C77.7725 11.5671 78.2146 11.0054 78.7972 10.5789C79.3797 10.1523 80.0871 9.93909 80.9193 9.93909C81.481 9.93909 81.9491 10.0431 82.3236 10.2512C82.7085 10.4488 83.0102 10.7193 83.2287 11.0626C83.4575 11.4059 83.6032 11.796 83.6656 12.2329C83.7384 12.6698 83.7436 13.1171 83.6812 13.5748C83.6604 13.7204 83.624 13.8245 83.572 13.8869C83.5199 13.9389 83.4263 13.9649 83.2911 13.9649H77.4708L77.5645 13.3876H83.3691L83.0726 13.5748C83.1559 13.0131 83.135 12.5033 83.0102 12.0456C82.8958 11.5879 82.6669 11.2238 82.3236 10.9533C81.9908 10.6725 81.5174 10.532 80.9037 10.532C80.2483 10.532 79.7022 10.6829 79.2653 10.9846C78.8388 11.2758 78.5059 11.6503 78.2666 12.108C78.0274 12.5553 77.8661 13.0183 77.7829 13.4968L77.7361 13.7777C77.5697 14.7763 77.7101 15.5877 78.1574 16.2119C78.6151 16.8256 79.3173 17.1325 80.2639 17.1325C80.7008 17.1325 81.1013 17.0805 81.4654 16.9765C81.8295 16.862 82.1884 16.6748 82.5421 16.4147C82.6357 16.3419 82.7189 16.3055 82.7918 16.3055C82.8646 16.2951 82.927 16.3107 82.979 16.3523C83.031 16.3835 83.0622 16.4303 83.0726 16.4927C83.0934 16.5551 83.0882 16.628 83.057 16.7112C83.0258 16.784 82.9686 16.8516 82.8854 16.914C82.5421 17.1741 82.1364 17.377 81.6683 17.5226C81.2106 17.6682 80.7529 17.741 80.2951 17.741Z"
          fill="#464646" />
        <defs>
          <linearGradient id="paint0_linear_5821_9543" x1="7.58999" y1="4.99708" x2="19.168" y2="25.0575"
            gradientUnits="userSpaceOnUse">
            <stop stop-opacity="0.2" />
            <stop offset="0.79" stop-opacity="0.05" />
          </linearGradient>
          <clipPath id="clip0_5821_9543">
            <rect width="24.2727" height="24.2727" fill="white" transform="translate(0 0.726562)" />
          </clipPath>
        </defs>
      </svg>
    </div>
    <div>
      <p style="font-size: 12px;
      line-height: 12px;
      padding: 0 10px;      
      color: #858B8F;">Copyright © 2022. All rights reserved. <br/> LoveMe Inc. Generate your personalized letter.</p>
    </div>
  </footer>
</body>
​
</html>")
    try:
        SENDGRID_API_KEY = os.getenv('SENDGRID_API_KEY') 
        sg = SendGridAPIClient(SENDGRID_API_KEY)
        response = sg.send(message)
        print(response.status_code)
        print(response.body)
        print(response.headers)
    except Exception as e:
        print(e.message)
    return {'Token Sent successfully to your email'}

